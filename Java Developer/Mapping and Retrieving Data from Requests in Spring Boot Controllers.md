[![spring-boot-logo.png](https://i.postimg.cc/8kd0mzMk/spring-boot-logo-2.png)](https://docs.spring.io/spring-framework/reference/web/webmvc/mvc-controller/ann-requestmapping.html)

## Урок: «Мэппинг и получение данных из запросов в контроллерах Spring Boot»

### 1. Вступление

Для начала давайте дадим определение некоторым понятиям, которые лежат в основе темы нашего урока.

**Spring Boot** очень удобен для создания RESTful веб-сервисов. Он предоставляет множество функций и инструментов, которые упрощают разработку и развертывание RESTful API. 

**RESTful веб-сервисы (или RESTful APIs)** — это архитектурный стиль для создания веб-сервисов, который использует стандартные HTTP методы и принципы REST (Representational State Transfer). RESTful веб-сервисы обеспечивают простоту и масштабируемость, что делает их популярным выбором для разработки API.

**Контроллеры** — это ключевой элемент любого веб-сервиса, построенного на базе Spring Boot. Они являются интерфейсом между клиентом и сервером и управляют передачей данных через HTTP-запросы. Умение настраивать и управлять контроллерами критически важно для разработчиков веб-приложений, которые используют Spring Boot.

**Мэппинг** в контроллерах Spring Boot — это процесс связывания (ассоциации) HTTP-запросов с определёнными методами контроллера, которые будут обрабатывать эти запросы.

Мэппинг позволяет разработчикам настроить маршрутизацию запросов (определить, какой метод контроллера будет вызван в ответ на определённый запрос) и указать, какие типы запросов (`GET`, `POST`, `PUT`, `DELETE` и т.д.) и URL-адреса (пути) связаны с этими методами.

Методы HTTP `GET`, `POST`, `PUT` и `DELETE` используются для выполнения различных операций с ресурсами на сервере:

- **GET**: Запрашивает данные с сервера. Используется для получения информации без изменений. Пример: получение списка пользователей.

- **POST**: Отправляет данные на сервер для создания нового ресурса. Используется для добавления новых данных. Пример: создание нового пользователя.

- **PUT**: Отправляет данные на сервер для обновления существующего ресурса. Используется для изменения существующих данных. Пример: обновление информации о пользователе.

- **DELETE**: Запрашивает удаление ресурса на сервере. Используется для удаления данных. Пример: удаление пользователя.

Эти методы являются основными в RESTful веб-сервисах и используются для работы с ресурсами через HTTP.

В Spring Boot мэппинг осуществляется с помощью аннотаций, которые указывают, какой HTTP-запрос должен быть направлен к какому методу. 

**Аннотации** в Spring Boot — это специальные метаданные, которые отмечены символом `@`, и которые используются для предоставления дополнительной информации о классах, методах и параметров методов. 

На этом уроке мы разберем, как настраивать мэппинг HTTP-запросов в контроллерах Spring Boot, а также как извлекать и обрабатывать данные, которые приходят с этими запросами. Эти знания помогут создавать более гибкие и эффективные приложения, работающие по принципу REST.

### 2. Основная часть урока

#### 2.1. Что такое контроллер в Spring Boot?

Контроллер — это Java-класс, который управляет поступающими HTTP-запросами и отвечает за передачу данных обратно пользователю или клиенту. Spring Boot использует аннотации для того, чтобы связать запросы с методами контроллеров. Основной аннотацией является `@RestController`, которая указывает Spring, что данный класс будет обрабатывать HTTP-запросы.

Аннотация `@RestController` в Spring Boot упрощает создание RESTful веб-сервисов, объединяя функции двух отдельных аннотаций: `@Controller` и `@ResponseBody`. 

Когда класс аннотирован `@RestController`, все методы этого класса по умолчанию возвращают данные в теле HTTP-ответа.

**Пример:**

```java
@RestController
public class MyController {
    // Методы обработки запросов
}
```

**Объяснение:** 

`@RestController` аннотирует класс `MyController`, что означает, что все методы этого класса будут возвращать данные в теле HTTP-ответа.



#### 2.2. Мэппинг запросов

Мэппинг (сопоставление) запросов — это процесс связывания HTTP-запроса с конкретным методом контроллера. Spring Boot предлагает несколько аннотаций для мэппинга:

- `@RequestMapping` — универсальная аннотация для обработки любого HTTP-запроса (`GET`, `POST`, `PUT`, `DELETE`).
- `@GetMapping`, `@PostMapping`, `@PutMapping`, `@DeleteMapping` — специализированные аннотации для обработки конкретных типов запросов.

Аннотация `@RequestMapping` используется для мэппинга HTTP-запросов к методам контроллеров. Это универсальная аннотация, которая позволяет настраивать мэппинг запросов для любых HTTP-методов, таких как `GET`, `POST`, `PUT`, `DELETE` и других

`@RequestMapping` можно применять как на уровне класса, так и на уровне метода.

Применение `@RequestMapping` на уровне класса задает базовый URL-адрес (или корневой URL) для всех методов контроллера.

**Пример:**

```java
@RestController
@RequestMapping("/api")
public class MyController {

    @GetMapping("/hello")
    public String hello() {
        return "Hello, World!";
    }
}
```
**Объяснение:**  
  
В этом примере метод `hello()` обрабатывает GET-запрос по адресу `/api/hello`.

Для того чтобы тестировать методы контроллера, необходимо формировать запросы с помощью таких инструментов, как [cURL](https://curl.se/), [Postman](https://www.postman.com/), [Insomnia](https://insomnia.rest/), [SoapUI](https://www.soapui.org/) и др. Подробнее о работе с этими инструментами можно ознакомиться на официальном сайте. 

В примере аннотация `@RequestMapping` на уровне класса задает базовый путь для всех методов в этом контроллере, поэтому все методы в этом контроллере будут обрабатывать запросы, которые начинаются с `/api`.

На уровне метода `@RequestMapping` задает точный URL-адрес и HTTP-метод для конкретного метода в контроллере.

**Пример:**

```java
@RestController
@RequestMapping("/api")  // Базовый путь для всех методов в этом классе
public class MyController {

    @RequestMapping(value = "/hello", method = RequestMethod.GET)
    public String sayHello() {
        return "Hello, World!";
    }

    @RequestMapping(value = "/goodbye", method = RequestMethod.POST)
    public String sayGoodbye() {
        return "Goodbye, World!";
    }
}
```
**Объяснение:**  
  
В этом примере на уровне класса аннотация @RequestMapping("/api") указывает, что все методы этого контроллера будут иметь базовый путь `/api`.  

Метод `sayHello()` будет обрабатывать GET-запросы на путь `/api/hello`.  

Метод `sayGoodbye()` будет обрабатывать POST-запросы на путь `/api/goodbye`.  

Аннотация `@RequestMapping` предоставляет множество атрибутов, которые позволяют настроить мэппинг HTTP-запросов к методам контроллера. Эти атрибуты помогают точнее контролировать, какие запросы обрабатываются каким методом, и как эти запросы должны быть обработаны.

Рассмотрим основные атрибуты аннотации `@RequestMapping`:

#### 1) Атрибут **`value`** или **`path`** определяет URL-адреса (или пути), к которым привязан метод контроллера.

**Пример:**  

  ```java
  @RequestMapping(value = "/api/greet", method = RequestMethod.GET)
  public String greet() {
      return "Hello!";
  }
  ```
**Объяснение:**  
  
  Здесь `value = "/api/greet"` задает путь `/api/greet`, который будет обрабатываться методом `greet()`.

#### 2) Атрибут **`method`** указывает HTTP-методы (GET, POST, PUT, DELETE и т.д.), для которых этот метод контроллера должен быть вызван.

**Пример:**  

  ```java
  @RequestMapping(value = "/api/create", method = RequestMethod.POST)
  public String create() {
      return "Resource created!";
  }
  ```
  Здесь `method = RequestMethod.POST` указывает, что метод `create()` обрабатывает только POST-запросы.

**Примечание:**  
Если вы используете Spring 4.3 и выше — то вместо `@RequestMapping` с указанием атрибута `method` со значениями `RequestMethod.GET`, `RequestMethod.POST`, `RequestMethod.PUT`, `RequestMethod.DELETE`, предпочтительнее использовать аннотации `@GetMapping`, `@PostMapping`, `@PutMapping`, `@DeleteMapping`. 

Позже мы рассмотрим, как применять `@GetMapping`, `@PostMapping`, `@PutMapping`, `@DeleteMapping` на практике.

#### 3) Атрибут **`params`** определяет параметры запроса, которые должны присутствовать в запросе для того, чтобы метод был вызван. Можно указывать конкретные значения параметров.

**Пример:**  

  ```java
  @RequestMapping(value = "/api/search", params = "query")
  public String search(@RequestParam String query) {
      return "Searching for: " + query;
  }
  ```
  **Объяснение:**  
  
  Здесь `params = "query"` указывает, что метод будет вызван только если параметр `query` присутствует в запросе, например, `/api/search?query=spring`.

#### 4) Атрибут **`headers`** определяет заголовки HTTP-запроса, которые должны присутствовать для того, чтобы метод был вызван. Можно указывать конкретные значения заголовков.

**Пример:**  

  ```java
  @RequestMapping(value = "/api/info", headers = "X-Requested-With=XMLHttpRequest")
  public String info() {
      return "Information from AJAX request";
  }
  ```
  **Объяснение:**  
  
  Здесь `headers = "X-Requested-With=XMLHttpRequest"` указывает, что метод будет вызван только если заголовок `X-Requested-With` имеет значение `XMLHttpRequest`.

#### 5) Атрибут **`produces`** определяет типы контента (MIME-типы), которые метод может возвращать. Используется для указания формата ответа.

**Пример:**

  ```java
  @RequestMapping(value = "/api/json", produces = "application/json")
  public String getJson() {
      return "{\"message\":\"Hello, JSON!\"}";
  }
  ```
  **Объяснение:**  
  
  Здесь `produces = "application/json"` указывает, что метод возвращает ответ в формате JSON.

#### 6) Атрибут **`consumes`** определяет типы контента (MIME-типы), которые метод может принимать в запросе. Используется для указания формата входных данных.

**Пример:**
  ```java
  @RequestMapping(value = "/api/upload", method = RequestMethod.POST, consumes = "multipart/form-data")
  public String upload(@RequestParam("file") MultipartFile file) {
      return "File uploaded successfully!";
  }
  ```
  Здесь `consumes = "multipart/form-data"` указывает, что метод принимает запросы с типом контента `multipart/form-data`, который обычно используется для загрузки файлов.

В контроллере, могут использоваться сразу несколько перечисленных атрибутов аннотации `@RequestMapping`.

**Пример:**

```java
@RestController
@RequestMapping("/api")
public class MyController {

    @RequestMapping(
        value = "/items",
        method = RequestMethod.GET,
        params = "category",
        headers = "Accept=application/json",
        produces = "application/json"
    )
    public String getItems(@RequestParam String category) {
        return "{\"category\":\"" + category + "\",\"items\":[\"Item1\",\"Item2\"]}";
    }

    @RequestMapping(
        value = "/items",
        method = RequestMethod.POST,
        consumes = "application/json"
    )
    public String createItem(@RequestBody String newItem) {
        return "Item created: " + newItem;
    }
}
```
**Объяснение:**  
  
В этом примере:
- **Метод `getItems`**:
  - Обрабатывает GET-запросы на путь `/api/items`.
  - Запрос должен содержать параметр `category`.
  - Запрос должен иметь заголовок `Accept` со значением `application/json`.
  - Возвращает ответ в формате JSON.

- **Метод `createItem`**:
  - Обрабатывает POST-запросы на путь `/api/items`.
  - Принимает тело запроса в формате JSON (`consumes = "application/json"`).

Эти атрибуты позволяют гибко настраивать обработку запросов и отвечать на различные сценарии использования в веб-приложении.

Как мы уже упоминали ранее в Spring Framework, если вы используете Spring 4.3 и выше — вместо `@RequestMapping` с указанием атрибута `method` со значениями `RequestMethod.GET`, `RequestMethod.POST`, `RequestMethod.PUT`, `RequestMethod.DELETE`, предпочтительнее использовать аннотации `@GetMapping`, `@PostMapping`, `@PutMapping`, `@DeleteMapping`. 

Рассмотрим, как их применять на практике.


#### 1) Аннотация `@GetMapping` используется для обработки HTTP GET-запросов.

**Пример:**

```java
@RestController
@RequestMapping("/api")
public class MyGetController {

    @GetMapping("/hello")
    public String hello() {
        return "Hello, World!";
    }

}
```

**Объяснение:**
- **`@GetMapping("/hello")`**: Обрабатывает GET-запросы на путь `/api/hello` и возвращает строку "Hello, World!".

#### 2) Аннотация `@PostMapping` используется для обработки HTTP POST-запросов.

**Пример:**

```java
@RestController
@RequestMapping("/api")
public class MyPostController {

    @PostMapping("/create")
    public String createItem(@RequestBody String item) {
        return "Item created: " + item;
    }
}
```

**Объяснение:**
- **`@PostMapping("/create")`**: Обрабатывает POST-запросы на путь `/api/create` и ожидает JSON-объект в теле запроса. Метод возвращает строку с сообщением о создании элемента.

#### 3) Аннотация `@PutMapping` используется для обработки HTTP PUT-запросов, которые часто применяются для обновления ресурса.

**Пример:**

```java
@RestController
@RequestMapping("/api")
public class MyPutController {

    @PutMapping("/update")
    public String updateItem(@RequestBody String item) {
        return "Item updated: " + item;
    }
}
```

**Объяснение:**
- **`@PutMapping("/update")`**: Обрабатывает PUT-запросы на путь `/api/update` и ожидает JSON-объект в теле запроса. Метод возвращает строку с сообщением об обновлении элемента.

#### 4) Аннотация `@DeleteMapping` используется для обработки HTTP DELETE-запросов, которые часто применяются для удаления ресурса.

**Пример:**

```java
@RestController
@RequestMapping("/api")
public class MyDeleteController {

    @DeleteMapping("/delete/{id}")
    public String deleteItem(@PathVariable("id") Long id) {
        return "Item with ID " + id + " deleted.";
    }
}
```

**Объяснение:**
- **`@DeleteMapping("/delete/{id}")`**: Обрабатывает DELETE-запросы на путь `/api/delete/{id}`, где `{id}` — это переменная пути. Метод удаляет элемент с указанным ID и возвращает строку с подтверждением удаления.

### Таким образом:

- **`@GetMapping`**: Обрабатывает GET-запросы. Используется для получения данных.
- **`@PostMapping`**: Обрабатывает POST-запросы. Используется для создания новых ресурсов.
- **`@PutMapping`**: Обрабатывает PUT-запросы. Используется для обновления существующих ресурсов.
- **`@DeleteMapping`**: Обрабатывает DELETE-запросы. Используется для удаления ресурсов.

Эти аннотации позволяют удобно и ясно определять, какие типы запросов обрабатываются методами контроллера.

#### 2.3. Получение данных из запросов

Важной частью работы с контроллерами является извлечение данных из HTTP-запросов. Рассмотрим основные аннотации для этого:

#### 2.3.1. Аннотация @RequestParam используется для извлечения данных из параметров запроса (query parameters). Это обычно те данные, которые идут после символа `?` в URL.

**Пример:**

```java
@GetMapping("/greet")
public String greet(@RequestParam(name = "name", defaultValue = "Guest") String name) {
    return "Hello, " + name;
}
```
**Объяснение:**  

Пример запроса: `GET /greet?name=John`  
Результат: `"Hello, John"`

#### 2.3.2. Аннотация @PathVariable используется для извлечения данных из переменных пути (path variables). Они являются частью самого URL.

**Пример:**

```java
@GetMapping("/user/{id}")
public String getUserById(@PathVariable("id") Long userId) {
    return "User ID: " + userId;
}
```

**Объяснение:**  


Пример запроса: `GET /user/123`  
Результат: `"User ID: 123"`

#### 2.3.3. Аннотация @RequestBody используется для получения данных из тела запроса (например, JSON) и автоматической их конвертации в объекты Java.

**Пример:**

```java
@PostMapping("/users")
public User createUser(@RequestBody User user) {
    return user;
}
```
**Объяснение:**  

Пример запроса: `POST /users` с телом запроса:

```json
{
  "id": 1,
  "firstName": "John",
  "lastName": "Doe",
  "age": 25
}
```

Результат: объект `User` будет передан методу `createUser`.

#### 2.3.4. Аннотация @RequestHeader используется для извлечения данных из заголовков HTTP-запроса.

**Пример:**

```java
@GetMapping("/header")
public String getHeader(@RequestHeader("User-Agent") String userAgent) {
    return "User-Agent: " + userAgent;
}
```
**Объяснение:**  

Пример запроса: `GET /header` 
Результат: Вывод заголовка `User-Agent`.



#### 2.4. Практические задания

Теперь перейдем к практическим заданиям, которые помогут закрепить изученный, в данном уроке, материал.

Все задания находятся в [Репозитории](https://github.com/sproshchaev/edutoria-demo/blob/main/spring-boot-mapping-requests/README.md) нашего урока в котором прилагается подробная инструкция относительно порядка выполнения.

Заготовки классов находятся в каталоге с суффиксом `-exercise`.

В каждом классе присутствуют комментарии `// TODO: ...` которые подскажут порядок выполнения задания.

После того, как вы выполните задание — можно сверить свое решение с правильным вариантом, который находится в том же репозитории в каталоге с суффиксом `-solution`.

**Задание 1**: Создайте контроллер с методом, который принимает GET-запрос и возвращает персонализированное приветствие в зависимости от параметра `name`.  
   
   _(подсказка: используйте `@RequestParam`)_

[Перейти к выполнению Задания 1](https://github.com/sproshchaev/edutoria-demo/blob/main/spring-boot-mapping-requests/task-01/task-01-exercise/src/main/java/ru/edutoria/Main.java)

**Задание 2**: Создайте контроллер, который принимает POST-запрос с данными пользователя в формате JSON и возвращает его возраст.  
   
   _(подсказка: используйте `@RequestBody`)_

[Перейти к выполнению Задания 2](https://github.com/sproshchaev/edutoria-demo/blob/main/spring-boot-mapping-requests/task-02/task-02-exercise/src/main/java/ru/edutoria/Main.java)

**Задание 3**: Реализуйте метод, который будет принимать переменную пути (например, ID пользователя) и возвращать это значение.  
   
   _(подсказка: используйте `@PathVariable`)_

[Перейти к выполнению Задания 3](https://github.com/sproshchaev/edutoria-demo/blob/main/spring-boot-mapping-requests/task-03/task-03-exercise/src/main/java/ru/edutoria/Main.java)  

### 3. Выводы и подведение итогов урока

Сегодня мы изучили ключевые аспекты работы с контроллерами в Spring Boot. Вы узнали, как настраивать мэппинг запросов с помощью аннотаций, а также как извлекать данные из различных частей HTTP-запросов: параметров, переменных пути, тела запроса и заголовков. 

**Основные тезисы темы урока:**

`1)` **Контроллеры в Spring Boot** являются ключевыми компонентами, обрабатывающими HTTP-запросы и формирующими ответы. Аннотация `@RestController` указывает, что класс является контроллером и обрабатывает запросы.

`2)` **Мэппинг HTTP-запросов** — это процесс связывания HTTP-запросов с методами контроллера. В Spring Boot используются аннотации `@RequestMapping` для универсального мэппинга, а также специализированные аннотации `@GetMapping`, `@PostMapping`, `@PutMapping`, `@DeleteMapping` для конкретных типов запросов.

`3)` **Извлечение данных из запросов** возможно с использованием аннотаций:
   - **@RequestParam** — извлекает данные из параметров запроса (query parameters), например, `GET /greet?name=John` использует параметр `name`.
   - **@PathVariable** — извлекает данные из переменных пути, например, `GET /user/123` использует `id` как часть пути.
   - **@RequestBody** — извлекает данные из тела запроса, часто в формате JSON, и автоматически конвертирует их в объекты Java.
   - **@RequestHeader** — позволяет получать значения заголовков HTTP-запроса, таких как `User-Agent`.

`4)` **Гибкость и эффективность**: Знание методов мэппинга и извлечения данных позволяет разработчикам создавать гибкие и эффективные веб-приложения с использованием Spring Boot, реализующие принципы REST и легко обрабатывающие различные типы запросов и данных.

### 4. Контрольное тестирование

Тестирование помогает закрепить знания, полученные на уроке. Проходя тесты, вы можете увидеть, насколько хорошо усвоили материал, выявить пробелы в понимании и скорректировать свое обучение. Это важный шаг к закреплению навыков и подготовке к более сложным задачам.

Тест построен на базе Google Forms и поможет проверить ваше понимание ключевых аспектов работы с контроллерами в Spring Boot.

#### Инструкция по прохождению теста:

`1)` Перед началом теста вам будет предложено ввести свой адрес электронной почты. Убедитесь, что вы указали правильный и действующий адрес, так как результаты теста будут отправлены на указанный адрес.

`2)` Тест состоит из **20 вопросов**. Каждый вопрос относится к материалу, который был представлен в уроке.

`3)` У каждого вопроса есть **три варианта ответа**. Только один из них является правильным.

`4)` Для каждого вопроса выберите **один правильный ответ**. Пожалуйста, убедитесь, что вы выбрали один ответ, прежде чем переходить к следующему вопросу.

`5)` Результаты теста будут автоматически направлены в почту, указанную при регистрации.

#### Удачи! 

[Пройти тест](https://forms.gle/ThAcBTWHqr1hAUYY7)

--- 

**На следующем уроке** мы углубимся в создание REST API и разберем, как обрабатывать различные HTTP-методы и статус-коды ответов.

**Список рекомендованной литературы:**

1. **"Spring Boot in Action"** — Craig Walls  
   Книга отлично подходит для новичков и объясняет основные принципы работы с Spring Boot, включая создание контроллеров, мэппинг запросов, обработку данных и другие важные темы.

2. **"Spring Microservices in Action"** — John Carnell  
   Эта книга поможет углубиться в разработку RESTful-сервисов и микросервисов с использованием Spring Boot, включая обработку запросов и настройку контроллеров.

3. **Документация Spring Framework**  
   Официальная документация Spring содержит актуальную и подробную информацию о мэппинге запросов, использовании аннотаций, работе с контроллерами и других аспектах: [Spring Framework Documentation](https://docs.spring.io/spring-framework/docs/current/reference/html/web.html).
